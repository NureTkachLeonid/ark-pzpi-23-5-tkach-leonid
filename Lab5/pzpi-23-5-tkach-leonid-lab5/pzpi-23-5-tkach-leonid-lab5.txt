МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ

КАФЕДРА ПРОГРАМНОЇ ІНЖЕНЕРІЇ

ЗВІТ
До лабораторної роботи №5
з дисципліни «Аналіз та рефакторинг коду»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач Леонід

Прийняв:
викладач катедри ПІ
Сокорчук Ігор Петрович

Харків 2025

________________

1 ІСТОРІЯ ЗМІН

№   Дата        Версія звіту    Опис змін та виправлень
1   05.02.2025  0.1             Створено звіт

________________

2 ЗАВДАННЯ

Набуття практичних навичок з розгортання програмної системи та перевірки її функціональності. У рамках роботи передбачено розгортання всіх компонентів системи — серверної частини та IoT-клієнта — із використанням сучасних інструментів контейнеризації та оркестрації, таких як Docker та Docker Compose. Особлива увага приділяється налаштуванню середовища роботи системи, включаючи сервер, базу даних PostgreSQL та мережеві параметри, для забезпечення коректної взаємодії всіх компонентів.

Наступним завданням є перевірка та налаштування роботи розгорнутої системи. Передбачено тестування стабільності та коректності функціонування серверної частини, IoT-клієнтів, бази даних та API, а також конфігурацію параметрів через змінні середовища для забезпечення надійного обміну даними та автоматизації розгортання.

________________

3 ОПИС ВИКОНАНОЇ РОБОТИ

Мета роботи полягала у розгортанні програмної системи догляду за рослинами, налаштуванні її компонентів та перевірці коректності роботи. Для реалізації цього завдання була використана контейнеризація за допомогою Docker та Docker Compose, що дозволило ізолювати серверну частину (FastAPI), базу даних PostgreSQL та IoT-клієнт у окремі контейнери, налаштувати мережеву взаємодію між ними і забезпечити можливість конфігурації через змінні середовища.

Використання контейнеризації забезпечило кілька ключових переваг: портативність системи між різними операційними системами, ізоляцію залежностей (Python libraries), полегшення розгортання та можливість швидкого масштабування.

На першому етапі була створена Docker-структура для бекенду, де застосунок Python/FastAPI збирається на базі образу `python:3.10-slim` та запускається у контейнері за допомогою Uvicorn. Для підключення до бази даних PostgreSQL використовувалися змінні середовища (`DATABASE_URL`), що дозволило динамічно змінювати конфігурацію без зміни коду. Для бази даних було налаштовано `healthcheck` у файлі `docker-compose.yml` (додаток Б.1), що гарантує старт бекенду лише після повної готовності бази даних.

Наступним кроком було налаштування IoT-клієнта. Скрипт емуляції сенсорів також був упакований у Docker-контейнер. Він автоматично підключається до бекенду всередині внутрішньої мережі Docker, використовуючи ім'я сервісу `backend` як хост. Це демонструє правильну організацію service discovery в межах оркестратора.

Крім того, для зручності розгортання було реалізовано Bash-скрипт `setup.sh` (додаток Б.2). Скрипт автоматизує процес створення файлу конфігурації `.env` та запуску контейнерів. Він дозволяє користувачеві ввести бажані параметри (пароль БД, порт сервера) або використати безпечні значення за замовчуванням. Також скрипт перевіряє наявність необхідних інструментів (Docker) перед запуском.

В результаті проведених дій система була успішно розгорнута, перевірено роботу API, запис даних у PostgreSQL та надходження телеметрії від IoT-клієнта. Реалізована архітектура демонструє сучасний підхід до DevOps та розгортання мікросервісів.

________________

4 ВИСНОВОК

У ході виконання лабораторної роботи було здійснено повне розгортання програмної системи «Smart Plant Care», включаючи серверну частину на FastAPI, базу даних PostgreSQL та IoT-клієнт. Було налаштовано середовище виконання, перевірено взаємодію компонентів через внутрішню мережу Docker та REST API, а також забезпечено надійне збереження даних.

Додатково були досліджені механізми автоматизації розгортання через скрипт `setup.sh` та використання змінних середовища для конфігурації. Розгортання системи в Docker-контейнерах продемонструвало ефективність ізоляції компонентів, спрощення налаштування та підвищення стабільності роботи системи.

________________

5 ВИКОРИСТАНІ ДЖЕРЕЛА

1. Docker Documentation. URL: https://docs.docker.com/ (дата звернення: 05.02.2025)
2. FastAPI Deployment with Docker. URL: https://fastapi.tiangolo.com/deployment/docker/ (дата звернення: 05.02.2025)
3. PostgreSQL Docker Image Documentation. URL: https://hub.docker.com/_/postgres (дата звернення: 05.02.2025)

________________

ДОДАТОК А
Відеозапис

Посилання на відео: [Посилання буде додано після запису]

________________

ДОДАТОК Б
Фрагменти програмного коду

Б.1 docker-compose.yml
version: '3.8'

services:
  db:
    image: postgres:15
    container_name: smart_plant_db
    env_file:
      - .env
    environment:
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: ${DB_NAME}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USER} -d ${DB_NAME}"]
      interval: 5s
      timeout: 5s
      retries: 5

  backend:
    build: ../../Lab3/pzpi-23-5-tkach-leonid-lab3/backend
    container_name: smart_plant_backend
    env_file:
      - .env
    environment:
      DATABASE_URL: postgresql://${DB_USER}:${DB_PASSWORD}@db:5432/${DB_NAME}
    ports:
      - "${SERVER_PORT}:8000"
    depends_on:
      db:
        condition: service_healthy

  iot-client:
    build: ../../Lab4/pzpi-23-5-tkach-leonid-lab4/iot-client
    container_name: smart_plant_iot
    env_file:
      - .env
    environment:
      SERVER_URL: http://backend:8000
      DEVICE_ID: 1
      SEND_INTERVAL: 10
    depends_on:
      - backend

volumes:
  postgres_data:


Б.2 Скрипт автоматичного розгортання (setup.sh)
#!/bin/bash
DEFAULT_DB_USER="postgres"
DEFAULT_DB_PASSWORD="password"
DEFAULT_DB_NAME="smart_plants"
DEFAULT_SERVER_PORT="8000"

echo "=== Smart Plant System Setup ==="
echo "Generating .env file..."

read -p "Enter Database User [${DEFAULT_DB_USER}]: " DB_USER
DB_USER=${DB_USER:-$DEFAULT_DB_USER}
# ... (input reading logic) ...

cat > .env <<EOL
DB_USER=${DB_USER}
DB_PASSWORD=${DB_PASSWORD}
DB_NAME=${DB_NAME}
SERVER_PORT=${SERVER_PORT}
EOL

echo "Starting Docker Compose..."
if command -v docker-compose &> /dev/null
then
    docker-compose up --build -d
else
    docker compose up --build -d
fi
