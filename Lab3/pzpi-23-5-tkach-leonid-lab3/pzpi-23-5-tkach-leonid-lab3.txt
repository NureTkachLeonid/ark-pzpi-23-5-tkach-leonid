МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ

КАФЕДРА ПРОГРАМНОЇ ІНЖЕНЕРІЇ

ЗВІТ
До лабораторної роботи №3
з дисципліни «Аналіз та рефакторинг коду»

Виконав:
ст. гр. ПЗПІ-23-5
Ткач Леонід

Прийняв:
викладач катедри ПІ
Сокорчук Ігор Петрович

Харків 2025

________________

1 ІСТОРІЯ ЗМІН

№   Дата        Версія звіту    Опис змін та виправлень
1   05.02.2025  0.1             Створено звіт

________________

2 ЗАВДАННЯ

Ознайомитися з процесом розробки бізнес логіки та функцій адміністрування серверної частини програмної системи. Отримати практичні навички реалізації бізнес логіки, функцій адміністрування, створення UML-діаграм діяльності та взаємодії, а також перевірки (тестування) роботи серверної частини.

________________

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 Адміністрування користувачів та рослин

Було реалізовано можливість адміністратору керувати користувачами та картками рослин у системі. Адміністратор може додавати нових користувачів, редагувати існуючих, блокувати доступ, а також керувати базою видів рослин та їх налаштуваннями (критичні показники вологості, температури). Всі дії виконуються через сервіси (Services), що взаємодіють із репозиторіями (Repositories) та моделями даних SQLAlchemy, забезпечуючи цілісність інформації.

Адміністратор може створювати резервні копії (бекапи) бази даних. Сервер реалізує даний функціонал за допомогою `BackupService`, який взаємодіє з файловою системою та зберігає копії файлу бази даних `sql_app.db` у визначеному форматі з часовою міткою. Основний метод — `create_backup()` (додаток В.1). Також адміністратор може переглядати список доступних бекапів та відновлювати дані з них.

Детальна взаємодія між шарами системи під час адміністрування показана на діаграмі взаємодії (додаток Б.1).

3.2 Прогноз стану ґрунту (EWMA та кліматичні корекції)

Для аналітики було реалізовано прогноз зміни вологості ґрунту на основі експоненційного згладженого середнього (EWMA) за формулою:

S_t = alpha * Y_t + (1 - alpha) * S_{t-1}

де:
- S_t – згладжене значення вологості на момент часу t (EWMA);
- Y_t – фактичне значення вологості, отримане з датчиків;
- alpha – коефіцієнт згладжування (визначає вагу нових даних).

При цьому до прогнозу може бути доданий коефіцієнт висихання, що залежить від температури навколишнього середовища:

Correction = BaseForecast / Factor

де:
- Factor = 1.0 + 0.05 * (Temp - 25.0) (якщо Temp > 25).

Метод використовує історичні дані `SensorData` та обчислює тренд падіння вологості. Це дозволяє попередити користувача про необхідність поливу ще до того, як рівень вологості стане критичним.

Реалізацію можна знайти у сервісі `AnalyticsService`. Ключовими методами є `forecast_moisture()` (додаток В.2), який формує прогноз, використовуючи допоміжний метод `calculate_ewma()` (додаток В.3). Метод `get_optimal_alpha()` (додаток В.5) автоматично підбирає коефіцієнт згладжування залежно від частоти оновлення даних з датчиків.

Детальна взаємодія між шарами системи під час виконання цього процесу показана на діаграмі взаємодії (додаток Б.2), а послідовність виконання — на діаграмі послідовності (додаток Б.3).

3.3 Статистика середніх показників рослини

Розроблено статистику середніх показників життєдіяльності (вологість, температура, освітлення) для кожної рослини. Функція обчислює середні значення за обраний період, що дозволяє визначити, чи знаходяться умови утримання в межах норми для даного виду. Для реалізації використовується метод `get_average_stats_per_plant()` (додаток В.6), який виконує агрегуючий запит до бази даних та повертає об'єкт зі статистикою.

Послідовність збору даних і обчислень представлена на діаграмі послідовності (Додаток Б.4). Ця статистика дозволяє користувачеві коригувати догляд за рослиною.

3.4 Часова статистика показників по годинах доби

Ще однією корисною статистикою є розподіл температури та освітлення за годинами доби. Це дає змогу побачити, як змінюються умови протягом дня (наприклад, чи не перегрівається рослина в обід). Метод `get_hourly_sensor_data()` (додаток В.7) групує дані `SensorData` по годинах та формує список середніх значень. Такий підхід дозволяє будувати графіки добових циклів.

Послідовність збору даних і обчислень представлена на діаграмі послідовності (додаток Б.5).

________________

4 ВИСНОВОК

У ході виконання роботи було розроблено ключові функції адміністрування та аналітики серверної частини системи догляду за рослинами. Було реалізовано управління користувачами та рослинами, а також функціонал створення резервних копій бази даних SQLite.

Для аналітики реалізовано прогноз необхідності поливу на основі алгоритму EWMA, що дозволяє передбачати критичне зниження вологості ґрунту. Крім того, реалізовані статистичні функції: розрахунок середніх показників стану рослини та погодинна динаміка змін температури й освітлення. Це дозволяє користувачам ефективніше доглядати за рослинами, спираючись на об'єктивні дані.

Усі функції були реалізовані мовою Python з використанням фреймворку FastAPI та ORM SQLAlchemy. Використання UML-діаграм допомогло спроектувати правильну архітектуру взаємодії компонентів.

________________

5 ВИКОРИСТАНІ ДЖЕРЕЛА

1. FastAPI Documentation. URL: https://fastapi.tiangolo.com/ (дата звернення: 18.12.2025)
2. SQLAlchemy 1.4 Documentation. URL: https://docs.sqlalchemy.org/en/14/ (дата звернення: 18.12.2025)
3. PlantUML – офіційна документація. URL: https://plantuml.com/ (дата звернення: 20.12.2025)
4. Wikipedia – Exponential moving average. URL: https://en.wikipedia.org/wiki/Exponential_smoothing (дата звернення: 19.12.2025)

________________

ДОДАТОК А

Відеозапис

Посилання на відео: https://youtu.be/TdUpRRYi0Qc
00:00 Вступ
00:35 Функції адміністрування (бекап, користувачі)
01:12 Перегляд аналітики (прогноз вологості)
02:44 Робота з датчиками
03:13 Тестування API

________________

ДОДАТОК Б

Графічні матеріали

Рисунок Б.1 – Діаграма взаємодії при створенні бекапу
Рисунок Б.2 — Діаграма взаємодії при розрахунку прогнозу
Рисунок Б.3 – Діаграма послідовності (EWMA)
Рисунок Б.4 – Діаграма послідовності (Середні показники)
Рисунок Б.5 – Діаграма послідовності (Погодинна статистика)

________________

ДОДАТОК В

Фрагменти коду

В.1 Код методу create_backup (Python)
(Див. файл services.py)

В.2 Метод forecast_moisture
(Див. файл services.py)

В.3 Метод calculate_ewma
(Див. файл services.py)

В.4 Метод weather_correction (Кліматична корекція)
(Див. файл services.py)

В.5 Метод get_optimal_alpha
(Див. файл services.py)

В.6 Метод get_average_stats_per_plant
(Див. файл services.py)

В.7 Метод get_hourly_sensor_data
(Див. файл services.py)
