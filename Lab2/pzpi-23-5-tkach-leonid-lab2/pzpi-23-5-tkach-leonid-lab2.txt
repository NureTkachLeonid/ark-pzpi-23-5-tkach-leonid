МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ

КАФЕДРА ПРОГРАМНОЇ ІНЖЕНЕРІЇ

Дисципліна «Аналіз та рефакторинг коду»
Звіт
з лабораторної роботи №2

Виконав:
ст. гр. ПЗПІ-23-5
Ткач Л. В.

Перевірив:
ст. викладач кафедри ПІ
Сокорчук І. П.

Харків – 2025

1 ІСТОРІЯ ЗМІН

№   Дата        Версія звіту    Опис змін та виправлень
1   04.02.2025  0.1             Створення початкової версії звіту

________________

2 ЗАВДАННЯ

Опанувати методи побудови UML та ER-діаграм, спроєктувати архітектуру бази даних та розробити специфікацію API для програмної системи.

________________

3 ОПИС ВИКОНАНОЇ РОБОТИ

3.1 UML-діаграма прецедентів
Діаграма прецедентів визначає основні ролі в системі та їх взаємодію з функціоналом.
У системі "Smart Plant Care" виділено двох головних акторів:
1. **Користувач (User):** Людина, яка володіє рослиною. Вона реєструється в системі, додає нові рослини ("фіто-профілі"), налаштовує критичні межі вологості для сповіщень та переглядає статистику.
2. **IoT-модуль (IoT Device):** Апаратний компонент (ESP32), який автоматично зчитує показники датчиків та надсилає їх на сервер через REST API.

Посилання: Рисунок 1 — UML-діаграма прецедентів.

3.2 Діаграма класів
Діаграма класів відображає статичну структуру програмних компонентів.
- **PlantController:** Відповідає за обробку HTTP-запитів, пов'язаних з рослинами (створення, редагування, видалення).
- **SensorDataService:** Сервісний шар, що приймає "сирі" дані від контролерів, валідує їх та зберігає в базу даних.
- **NotificationSystem:** Окремий модуль, який перевіряє вхідні дані на відповідність налаштуванням (`PlantSettings`) і генерує алерт, якщо вологість нижче норми.

Посилання: Рисунок 2 — Загальна діаграма класів.

3.3 ER-діаграма та Нормалізація бази даних
У ході проєктування бази даних було проведено процес нормалізації для забезпечення цілісності даних та уникнення дублювання.

**Перша нормальна форма (1NF):**
Всі атрибути відношень є атомарними. У таблиці `users` поле `full_name` містить повне ім'я, але воно вважається єдиним логічним елементом у контексті нашої системи. Жодне поле не містить списків значень (наприклад, список рослин не зберігається в одному полі користувача, а винесений в окрему таблицю).

**Друга нормальна форма (2NF):**
Таблиці знаходяться в 1NF, і всі неключові атрибути повністю залежать від первинного ключа. Наприклад, у таблиці `sensor_data` (похідна від `plants`) значення вологості `soil_moisture` залежить від конкретного запису заміру (`id`), а не від частини ключа.

**Третя нормальна форма (3NF):**
Відсутні транзитивні залежності неключових атрибутів від інших неключових атрибутів. Наприклад, вид рослини (`species`) залежить безпосередньо від сутності `plant`, а не від власника рослини.

Схема бази даних включає таблиці:
- `users` (Користувачі)
- `plants` (Рослини, зв'язок Many-to-One з users)
- `plant_settings` (Налаштування, зв'язок One-to-One з plants)
- `sensor_data` (Дані сенсорів, зв'язок One-to-Many з plants)

Посилання: Рисунок 3 — ER-діаграма.

3.4 Специфікація API
Розроблено RESTful API для взаємодії клієнтських додатків та IoT-пристроїв з сервером.

Таблиця 1 – Специфікація API

| Метод | Ендпоінт | Опис |
|---|---|---|
| POST | /api/auth/register | Реєстрація нового користувача |
| POST | /api/auth/login | Аутентифікація та отримання JWT токена |
| GET | /api/plants | Отримати список всіх рослин користувача |
| POST | /api/plants | Додати нову рослину |
| GET | /api/plants/{id} | Отримати деталі конкретної рослини |
| PUT | /api/plants/{id} | Оновити інформацію про рослину |
| DELETE | /api/plants/{id} | Видалити рослину |
| GET | /api/plants/{id}/settings | Отримати поточні налаштування рослини |
| PUT | /api/plants/{id}/settings | Оновити налаштування поливу (мін/макс межі) |
| POST | /api/sensor/data | Прийом телеметрії від IoT-пристрою (ESP32) |
| GET | /api/plants/{id}/stats | Отримати історію показників за період |
| GET | /api/admin/users | Отримати список користувачів (для адміна) |
| GET | /api/reports/daily | Згенерувати денний звіт по всім рослинам |

3.5 Програмна реалізація (Backend)
Серверна частина системи реалізована мовою програмування Python з використанням фреймворку FastAPI. Цей вибір обумовлений необхідністю швидкої асинхронної обробки HTTP-запитів, які будуть надходити від IoT-пристроїв (ESP32/C++), а також зручністю роботи з базою даних через ORM SQLAlchemy.

Основні компоненти реалізації:
1. **Моделі даних (models.py):** Описують структуру таблиць БД у вигляді Python-класів, що дозволяє працювати з даними як з об'єктами.
2. **REST-контролер (main.py):** Містить обробники запитів (ендпоінти). Ключовим для IoT-системи є метод приймання телеметрії.

Фрагмент коду (IoT endpoint):
```python
@app.post("/api/sensor/data", tags=["IoT"])
def receive_sensor_data(data: schemas.SensorDataCreate, db: Session = Depends(get_db)):
    """
    Прийом телеметрії від IoT-пристрою (ESP32).
    JSON Payload: {"plant_id": 1, "soil_moisture": 450, "temperature": 23.5, "light_level": 1200}
    """
    # Валідація та збереження даних
    db_sensor_data = models.SensorData(**data.dict())
    db.add(db_sensor_data)
    db.commit()
    return db_sensor_data
```

Така архітектура дозволяє чітко розділити відповідальність:
- **C++ (IoT Device):** Збирає дані з сенсорів, формує JSON, відправляє POST-запит.
- **Python (Server):** Приймає запит, валідує дані, зберігає в БД та надає API для мобільного додатаку.

________________

ВИСНОВКИ

У ході лабораторної роботи було спроєктовано архітектуру серверної частини системи "Smart Plant Care". Розроблені UML-діаграми дозволили чітко визначити взаємодію акторів та структуру класів. Спроєктована схема бази даних відповідає третій нормальній формі (3NF), що забезпечує надійне зберігання даних. Специфікація API покриває всі необхідні сценарії використання, від реєстрації користувача до збору телеметрії з датчиків.

________________

ДОДАТОК А

Посилання на відеозапис: https://youtu.be/placeholder_lab2
Таймкоди:
00:00 – Діаграма прецедентів (Use Case)
00:45 – Діаграма класів
01:30 – ER-діаграма та нормалізація БД
02:15 – Огляд спроєктованого API
02:50 – Висновки
